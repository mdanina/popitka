# WhisperX Локальный Транскрибатор

Офлайн транскрибатор аудио на базе WhisperX с диаризацией спикеров. Оптимизирован для компьютеров средней мощности и длинных аудиофайлов (1+ час).

## Возможности

- Транскрибация длинных аудиофайлов (1+ час)
- Диаризация спикеров (определение кто говорит)
- Поддержка русского и английского языка
- Работа полностью офлайн (после скачивания моделей)
- Оптимизация для CPU (int8 квантизация)
- Форматы вывода: TXT, SRT, JSON

## Требования

- Python 3.8+
- FFmpeg
- 4+ GB RAM (рекомендуется 8+ GB)
- HuggingFace аккаунт (для диаризации)

## Установка

### 1. Установка FFmpeg

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install ffmpeg
```

**macOS:**
```bash
brew install ffmpeg
```

**Windows:**
Скачайте с https://ffmpeg.org/download.html и добавьте в PATH.

### 2. Создание виртуального окружения

```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# или
venv\Scripts\activate  # Windows
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Настройка HuggingFace (для диаризации)

Диаризация использует модели pyannote.audio через HuggingFace. Необходимо:

1. Зарегистрироваться на https://huggingface.co
2. Принять условия использования моделей:
   - https://huggingface.co/pyannote/speaker-diarization-3.1
   - https://huggingface.co/pyannote/segmentation-3.0
3. Создать токен: https://huggingface.co/settings/tokens
4. Установить переменную окружения:

```bash
export HF_TOKEN="your_token_here"
```

Или добавить в `~/.bashrc` / `~/.zshrc` для постоянного использования.

### 5. Предварительная загрузка моделей (для офлайн работы)

Запустите транскрибацию один раз с интернетом - модели скачаются автоматически:

```bash
python transcriber.py test_audio.mp3 -l ru --diarize
```

После этого всё будет работать офлайн.

## Использование

### Базовое использование

```bash
# Транскрибация на русском с диаризацией
python transcriber.py audio.mp3 -l ru

# Транскрибация на английском
python transcriber.py audio.mp3 -l en

# Без диаризации (не нужен HF токен)
python transcriber.py audio.mp3 -l ru --no-diarize
```

### Настройки для слабых ПК

```bash
# Маленькая модель + минимальный батч
python transcriber.py audio.mp3 -l ru -m base -b 4

# Самая легкая модель
python transcriber.py audio.mp3 -l ru -m tiny -b 2
```

### Форматы вывода

```bash
# Субтитры SRT
python transcriber.py audio.mp3 -l ru -f srt

# JSON (машиночитаемый)
python transcriber.py audio.mp3 -l ru -f json

# Текст (по умолчанию)
python transcriber.py audio.mp3 -l ru -f txt
```

### Все опции

```bash
python transcriber.py --help
```

| Опция | Описание | По умолчанию |
|-------|----------|--------------|
| `-l, --language` | Язык (ru/en) | ru |
| `-m, --model` | Размер модели | small |
| `--diarize/--no-diarize` | Диаризация | включена |
| `--hf-token` | HuggingFace токен | HF_TOKEN |
| `-o, --output` | Путь вывода | автогенерация |
| `-f, --format` | Формат (txt/srt/json) | txt |
| `-b, --batch-size` | Размер батча | 8 |
| `-c, --compute-type` | Тип вычислений | int8 |

## Выбор модели

| Модель | RAM | Качество | Скорость | Рекомендация |
|--------|-----|----------|----------|--------------|
| tiny | ~1 GB | Низкое | Очень быстро | Тесты |
| base | ~1 GB | Среднее | Быстро | Слабые ПК |
| **small** | ~2 GB | Хорошее | Средне | **Рекомендуется** |
| medium | ~5 GB | Отличное | Медленно | Мощные ПК |
| large-v3 | ~10 GB | Лучшее | Медленно | GPU |

Для компьютеров средней мощности рекомендуется модель **small** с `int8` квантизацией.

## Примеры вывода

### TXT формат
```
[00:00:01.200 - 00:00:05.800] SPEAKER_00: Добрый день, начинаем совещание.
[00:00:06.100 - 00:00:12.400] SPEAKER_01: Да, давайте обсудим первый вопрос.
```

### SRT формат
```
1
00:00:01,200 --> 00:00:05,800
[SPEAKER_00] Добрый день, начинаем совещание.

2
00:00:06,100 --> 00:00:12,400
[SPEAKER_01] Да, давайте обсудим первый вопрос.
```

## Решение проблем

### Нехватка памяти
- Уменьшите batch_size: `-b 4` или `-b 2`
- Используйте меньшую модель: `-m base` или `-m tiny`

### Медленная работа
- Используйте GPU если есть: автоматически определится
- Уменьшите модель: `-m small` вместо `-m medium`

### Ошибка диаризации
- Проверьте HF_TOKEN
- Примите условия моделей на HuggingFace
- Используйте `--no-diarize` для работы без диаризации

### Не распознаётся язык
- Явно укажите язык: `-l ru` или `-l en`

## Ограничения

- Диаризация требует HuggingFace токен и принятия лицензий
- Первый запуск требует интернет для скачивания моделей
- Большие модели требуют много RAM/VRAM

## Лицензия

MIT
